{"version":3,"file":"user-intent.min.js","sources":["../src/triggers/idle.js","../src/triggers/scroll.js","../src/triggers/windowFocus.js","../src/triggers/windowOut.js","../src/schema.js","../src/triggers/target.js","../src/utils/eventsListenersCleanup.js","../src/utils/eventsListenersAttach.js","../src/index.js"],"sourcesContent":["/**\n * @param {MouseEvent|KeyEvent|TouchEvent} event\n * @returns {void}\n */\nfunction handleIdleness() {\n    if (this.invoked) return;\n    clearTimeout(this.timer);\n    this.timer = setTimeout(() => {\n        this.fire();\n    }, this._opts.delay);\n}\n\n/**\n * @returns {void}\n */\nfunction registerIdlenessHandler() {\n    const eventsTypes = this._opts.events;\n    const eventsTypesLen = eventsTypes.length;\n    for (let i = 0; i < eventsTypesLen; i += 1) {\n        const eventType = eventsTypes[i];\n        const boundListener = handleIdleness.bind(this);\n        this.attachEvents([{ el: document, type: eventType, listener: boundListener }]);\n    }\n}\n\n/**\n * @returns {void}\n */\nexport default function idle() {\n    const boundListener = handleIdleness.bind(this);\n    this.attachEvents([{ el: window, type: 'load', listener: boundListener }]);\n    registerIdlenessHandler.call(this);\n}\n","let lastScrollTop = 0; // To detect scroll direction\nlet lastScrollTopBeforeUp = 0;\n\n/**\n * @param {Number} docHeight\n * @returns {void}\n */\nfunction handleScroll(docHeight, percentUp) {\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    const downScroll = scrollTop > lastScrollTop;\n    const downScrollPercent = docHeight * (parseFloat(this._opts.percentDown) / 100);\n    const upScrollPercent = percentUp\n        ? lastScrollTopBeforeUp - Math.round((lastScrollTopBeforeUp / 100) * percentUp)\n        : 0;\n\n    if (downScroll && !percentUp && scrollTop >= downScrollPercent) {\n        this.fire();\n    }\n\n    if (!downScroll && upScrollPercent && scrollTop <= upScrollPercent && lastScrollTopBeforeUp >= downScrollPercent) {\n        this.fire();\n    }\n\n    if (downScroll && percentUp) {\n        lastScrollTopBeforeUp = scrollTop;\n    }\n\n    lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // For Mobile or negative scrolling\n}\n\n/**\n * @returns {void}\n */\nexport default function scroll() {\n    const { body } = document;\n    const html = document.documentElement;\n    let docHeight = Math.max(\n        body.scrollHeight,\n        body.offsetHeight,\n        html.clientHeight,\n        html.scrollHeight,\n        html.offsetHeight,\n    );\n\n    // Calculate the bottom of the viewport\n    docHeight = parseInt(docHeight - window.innerHeight, 10);\n    if (this._opts.offsetTop) {\n        docHeight -= this._opts.offsetTop;\n    }\n    if (this._opts.offsetBottom) {\n        docHeight += this._opts.offsetBottom;\n    }\n\n    const boundListener = handleScroll.bind(this, docHeight, this._opts.percentUp);\n\n    if (!this.invoked) {\n        this.attachEvents([{ el: window, type: 'scroll', listener: boundListener }]);\n    }\n}\n","/**\n * @param {FocusEvent} event\n * @returns {void}\n */\nfunction handleWindowBlur() {\n    this.windowBlurred = true;\n}\n\n/**\n * @param {FocusEvent} event\n * @returns {void}\n */\nfunction handleWindowFocus() {\n    if (this.windowBlurred && !this.invoked) {\n        this.fire();\n        this.windowBlurred = false;\n    }\n}\n\n/**\n * @returns {void}\n */\nexport default function windowFocus() {\n    const boundWindowBlur = handleWindowBlur.bind(this);\n    const boundWindowFocus = handleWindowFocus.bind(this);\n\n    // detect visibilitychange in browser\n    let hiddenVar = '';\n    let eventType = '';\n    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n    if ('hidden' in document) {\n        hiddenVar = 'hidden';\n        eventType = 'visibilitychange';\n    }\n\n    if ('mozHidden' in document) {\n        hiddenVar = 'mozHidden';\n        eventType = 'mozvisibilitychange';\n    }\n\n    if ('webkitHidden' in document) {\n        hiddenVar = 'webkitHidden';\n        eventType = 'webkitvisibilitychange';\n    }\n\n    if ('msHidden' in document) {\n        hiddenVar = 'msHidden';\n        eventType = 'msvisibilitychange';\n    }\n\n    if (hiddenVar && eventType && !isSafari) {\n        const handleVisibility = () => {\n            (document[hiddenVar] ? boundWindowBlur : boundWindowFocus)();\n        };\n        this.attachEvents([{ el: document, type: eventType, listener: handleVisibility }]);\n    } else {\n        this.attachEvents([\n            { el: window, type: 'blur', listener: boundWindowBlur },\n            { el: window, type: 'focus', listener: boundWindowFocus },\n        ]);\n    }\n}\n","/**\n * @param {MouseEvent} event\n * @returns {void}\n */\nfunction handleMouseLeave(event) {\n    if (!this.invoked && event.clientY < 0) {\n        this.fire();\n    }\n}\n\n/**\n * @returns {void}\n */\nexport default function windowOut() {\n    const boundMouseLeave = handleMouseLeave.bind(this);\n    this.attachEvents([{ el: document, type: 'mouseleave', listener: boundMouseLeave }]);\n}\n","import * as triggers from './triggers';\n\nconst schema = {\n    idle: {\n        fn: triggers.idle,\n        opts: {\n            events: ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'],\n            delay: 10000,\n            multiple: false,\n        },\n    },\n    scroll: {\n        fn: triggers.scroll,\n        opts: {\n            percentDown: 50,\n            percentUp: 0,\n            offsetTop: 0,\n            offsetBottom: 0,\n        },\n    },\n    target: {\n        fn: triggers.target,\n        opts: {\n            target: '',\n            offsetTop: 0,\n            offsetBottom: 0,\n            multiple: false,\n        },\n    },\n    focus: {\n        fn: triggers.windowFocus,\n        opts: {\n            multiple: false,\n        },\n    },\n    out: {\n        fn: triggers.windowOut,\n        opts: {\n            multiple: false,\n        },\n    },\n};\n\nexport default Object.freeze(schema);\n","/**\n * @returns {void}\n */\nexport default function target() {\n    if (!this._opts.target) {\n        console.error('ðŸ”¥ you have to provide a target selector within the options object to UserIntent().');\n        return;\n    }\n\n    const targetEl = document.querySelector(this._opts.target);\n    if (!targetEl) {\n        console.error(`ðŸ”¥ cannot find the provided target \"${this._opts.target}\".`);\n        return;\n    }\n\n    const observerOpts = { rootMargin: `${this._opts.offsetTop}px 0px ${this._opts.offsetBottom}px 0px` };\n    const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n            if (entry.isIntersecting && !this.invoked) {\n                this.fire();\n                if (!this._opts.multiple) {\n                    observer.unobserve(entry.target);\n                }\n            }\n        });\n    }, observerOpts);\n\n    observer.observe(targetEl);\n}\n","/**\n * @param {Object[]} eventsArr\n * @returns {void}\n */\nexport default function eventsListenersCleanup(eventsArr = []) {\n    const eventsArrLen = eventsArr.length;\n\n    if (!eventsArrLen) return;\n\n    for (let i = 0; i < eventsArrLen; i += 1) {\n        const eventObj = eventsArr[i];\n        eventObj.el.removeEventListener(eventObj.type, eventObj.listener);\n    }\n}\n","/**\n * @param {Object[]} eventsArr\n * @returns {void}\n */\nexport default function eventsListenersAttach(eventsArr = []) {\n    const eventsArrLen = eventsArr.length;\n\n    if (!eventsArrLen) return;\n\n    for (let i = 0; i < eventsArrLen; i += 1) {\n        const { el, type, listener } = eventsArr[i];\n        el.addEventListener(type, listener);\n    }\n}\n","import schema from './schema';\nimport { eventsListenersAttach, eventsListenersCleanup } from './utils';\n\nexport default function UserIntent(cb, opts = {}) {\n    if (typeof opts !== 'object') {\n        console.error('ðŸ”¥ wrong options type passed to UserIntent().');\n        return;\n    }\n    if (typeof cb === 'undefined') {\n        console.error('ðŸ”¥ you have to pass a callback to UserIntent().');\n        return;\n    }\n    if (opts.mode && typeof schema[opts.mode] === 'undefined') {\n        console.error('ðŸ”¥ wrong mode passed to UserIntent().');\n        return;\n    }\n\n    const mode = opts.mode || 'out';\n\n    // Clone the passed options to delete the mode key from it\n    const optsClone = { ...opts };\n    delete optsClone.mode;\n\n    // Now we have all the other passed options, let's validate and fallback to default options\n    const defaultOpts = schema[mode].opts;\n    const defaultOptsKeys = Object.keys(defaultOpts);\n    const defaultOptsKeysLen = defaultOptsKeys.length;\n    if (defaultOptsKeysLen) {\n        for (let i = 0; i < defaultOptsKeysLen; i += 1) {\n            const optKey = defaultOptsKeys[i];\n            const optDefaultValue = defaultOpts[optKey];\n            if (typeof optsClone[optKey] === 'undefined') {\n                optsClone[optKey] = optDefaultValue;\n            }\n        }\n    }\n\n    this._mode = mode;\n    this._opts = optsClone;\n    this._cb = cb;\n    this.invoked = false;\n    this.timer = null;\n    this.windowBlurred = false;\n    this.addedEvents = [];\n\n    /**\n     * @param {Object[]} eventsArr\n     * @returns {void}\n     */\n    this.attachEvents = (eventsArr) => {\n        eventsListenersAttach(eventsArr);\n        this.addedEvents.push(...eventsArr);\n    };\n\n    /**\n     * @returns {void}\n     */\n    this.fire = () => {\n        cb(this._mode, { ...this._opts });\n        if (!this._opts.multiple) {\n            this.invoked = true;\n            eventsListenersCleanup(this.addedEvents);\n        }\n    };\n\n    schema[mode].fn.call(this);\n}\n"],"names":["handleIdleness","this","invoked","clearTimeout","timer","setTimeout","_this","fire","_opts","delay","registerIdlenessHandler","eventsTypes","events","eventsTypesLen","length","i","eventType","boundListener","bind","attachEvents","el","document","type","listener","lastScrollTop","lastScrollTopBeforeUp","handleScroll","docHeight","percentUp","scrollTop","window","pageYOffset","documentElement","downScroll","downScrollPercent","parseFloat","percentDown","upScrollPercent","Math","round","handleWindowBlur","windowBlurred","handleWindowFocus","handleMouseLeave","event","clientY","schema","idle","fn","call","opts","multiple","scroll","body","html","max","scrollHeight","offsetHeight","clientHeight","parseInt","innerHeight","offsetTop","offsetBottom","target","targetEl","querySelector","observerOpts","rootMargin","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","unobserve","observe","console","error","focus","boundWindowBlur","boundWindowFocus","hiddenVar","isSafari","test","navigator","userAgent","out","boundMouseLeave","Object","freeze","eventsListenersCleanup","eventsArr","eventsArrLen","eventObj","removeEventListener","eventsListenersAttach","addEventListener","cb","_typeof","mode","optsClone","defaultOpts","defaultOptsKeys","keys","defaultOptsKeysLen","optKey","optDefaultValue","_mode","_cb","addedEvents","push"],"mappings":"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"}